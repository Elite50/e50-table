/*! e50-table 2016-06-08 */
"use strict";angular.module("e50Table",["ngResource"]),angular.module("e50Table").directive("e50DragHandle",["$parse",function(a){return{restrict:"A",link:function(b,c,d){function e(){c.css({cursor:"move"}),c.on("dragstart.e50Table",function(){return!1}),c.on("mousedown.e50Table",function(a){b.e50StartDrag(a),a.stopPropagation()})}function f(){c.css({cursor:""}),c.off("dragstart.e50Table"),c.off("mousedown.e50Table")}d.e50DragHandle?b.$watch(function(){return a(d.e50DragHandle)(b)},function(a){a?e():f()}):e()}}}]),angular.module("e50Table").directive("e50Drag",["$timeout",function(a){return{restrict:"A",require:"^e50Table",link:function(b,c,d,e){function f(){var a=e.$attrs.e50Table?"="+e.$attrs.e50Table:"",b=e.$element[0].querySelectorAll("[e50-table-row"+a+"]"),c=[];return angular.forEach(b,function(a){c.push({top:a.getBoundingClientRect().top,left:a.getBoundingClientRect().left})}),c}function g(){var a="e50DataKey"in e.$attrs?e.$attrs.e50DataKey:"t";b[a].$$e50FindRow=!0;for(var c=0;c<b.e50FilteredData.length;c++)if(b.e50FilteredData[c].$$e50FindRow)return delete b[a].$$e50FindRow,c}function h(a,b){if("e50DragGravity"in d){var c=parseInt(d.e50DragGravity)||0,e=Math.abs(b-a),f=e>c?Math.round(Math.sqrt(e-c))+c:e;return a+(b>a?1:-1)*f}return a}function i(a,c){var d,e=Number.MAX_VALUE;angular.forEach(o,function(b,f){var g=b.top-a,h=b.left-c,i=Math.sqrt(g*g+h*h);e>i&&(e=i,d=f)}),p!==d&&(b.e50MoveData(p,d),p=d,o=f())}var j,k,l,m,n,o,p;b.e50StartDrag=function(b){a(function(){m=c[0].getBoundingClientRect().top,n=c[0].getBoundingClientRect().left,k=b.clientY-m,l=b.clientX-n,o=f(),p=g(),c.addClass("e50-dragging"),"e50DragClass"in d&&c.addClass(d.e50DragClass),j=angular.element("<div></div>").css({position:"absolute",width:c[0].clientWidth,height:c[0].clientHeight,top:m,left:n,zIndex:1e7,cursor:"move"}).addClass("e50-drag-overlay"),"e50DragOverlayClass"in d&&j.addClass(d.e50DragOverlayClass),angular.element("body").append(j).css({userSelect:"none"}).on("mousemove",function(a){var b="e50DragX"in d?h(m,a.clientY-k):a.clientY-k,c="e50DragY"in d?h(n,a.clientX-l):a.clientX-l;j.css({top:b,left:c}),i(b,c)}).on("mouseup",function(){j.remove(),c.removeClass("e50-dragging"),"e50DragClass"in d&&c.removeClass(d.e50DragClass),angular.element("body").css({userSelect:""}).off("mouseup mousemove")})})}}}}]),angular.module("e50Table").directive("e50Fetch",["$parse","$resource","E50Poll","$timeout",function(a,b,c,d){return{restrict:"A",require:"e50Table",link:function(e,f,g){function h(b,c){n=angular.copy(a(g.e50FetchParams)(e)),o=angular.copy(a(g.e50FetchBody)(e));var f=!1;if(b||!e.e50FilteredData||e.e50FilteredData.length||e.e50SetData(void 0),k){var h=n&&p in n?n:o,t=n&&q in n?n:o;c&&!j?(h[p]=r,f=!0):j&&(b||c)?t[q]=s:(r=h[p],s=t[q])}var v=m;b||(m++,v=m,e.e50FetchCount++);var w=u.fetch(n,o).$promise.then(function(b){if(v===m){if(angular.equals(e.e50GetData(),b.data))c&&(i=!1);else{if(i=!0,f){var h=b.data,j=e.e50GetData();"e50DataProp"in g&&(h=h[g.e50DataProp],j=j[g.e50DataProp]),h.length||(i=!1),Array.prototype.push.apply(j,h)}else e.e50SetData(b.data);k&&d(e.e50InfiniteScroll)}"e50IfSuccess"in g&&a(g.e50IfSuccess)(e)(b)}},function(b){"e50IfError"in g&&a(g.e50IfError)(e)(b)}).finally(function(){l=!0,b||e.e50FetchCount--});return"e50Loading"in g&&!b&&!c&&("emit"!==g.e50Loading&&e.$broadcast("loading",w,"e50-table-loading",!0),"broadcast"!==g.e50Loading&&e.$emit("loading",w,"e50-table-loading",!0)),"e50InfiniteLoading"in g&&c&&("emit"!==g.e50InfiniteLoading&&e.$broadcast("loading",w,"e50-table-infinite-loading",!0),"broadcast"!==g.e50InfiniteLoading&&e.$emit("loading",w,"e50-table-infinite-loading",!0)),w}var i=!0,j="e50Poll"in g,k="e50InfiniteScroll"in g,l=!1,m=0;e.e50FetchCount=0;var n=angular.copy(a(g.e50FetchParams)(e)),o=angular.copy(a(g.e50FetchBody)(e));if(k)var p="e50OffsetKey"in g?g.e50OffsetKey:"offset",q="e50LimitKey"in g?g.e50LimitKey:"limit",r=n&&p in n?n[p]:o[p],s=n&&q in n?n[q]:o[q],t=s;var u=b(g.e50Fetch,{},{fetch:{method:"e50FetchMethod"in g?g.e50FetchMethod:"GET"}});if("e50FetchOnce"in g?h():e.$watch(function(){return[a(g.e50FetchParams)(e),a(g.e50FetchBody)(e)]},function(){l&&"e50FetchLimit"in g&&"e50FetchLimitProp"in g&&e.e50GetData()[g.e50FetchLimitProp]<=g.e50FetchLimit||h()},!0),j){var v=new c(function(){return h(!0)},g.e50Poll);e.$on("$destroy",function(){v.stop()})}e.$on("e50-infinite-scroll",function(){i&&(j?s+=t:r+=s,h(!1,!0))})}}}]),angular.module("e50Table").directive("e50Hover",["$parse",function(a){return{restrict:"A",link:function(b,c,d){var e=d.e50Hover?d.e50Hover:"hover";c.on("mouseenter",function(){"e50HoverIf"in d&&!a(d.e50HoverIf)(b)||c.addClass(e)}).on("mouseleave",function(){c.removeClass(e)})}}}]),angular.module("e50Table").directive("e50IfData",function(){return{restrict:"A",require:"^e50Table",link:function(a,b,c){var d="false"!==c.e50IfData,e=c.e50IfNoData?c.e50IfNoData:null,f=angular.element('<div class="e50-no-data">'+e+"</div>"),g="e50IfLoadingData"in c?c.e50IfLoadingData.length?c.e50IfLoadingData:"Loading data":null,h=angular.element('<div class="e50-no-data">'+g+"</div>");a.$watchCollection("e50FilteredData",function(a){"undefined"==typeof a?(g&&b.parent()[0].insertBefore(h[0],b[0]),f.remove(),d?b.css("display","none"):b.css("display","")):a.length?(f.remove(),h.remove(),d?b.css("display",""):b.css("display","none")):(e&&b.parent()[0].insertBefore(f[0],b[0]),h.remove(),d?b.css("display","none"):b.css("display",""))})}}}),angular.module("e50Table").directive("e50InfiniteScroll",["$parse",function(a){return{restrict:"A",require:"e50Table",link:function(b,c,d){function e(a){var b,c=a.css("position"),d="absolute"===c;for(b=a.parent();b[0]&&(d&&"static"===b.css("position")||!/(auto|scroll)/.test(b.css("overflow")+b.css("overflow-y")+b.css("overflow-x")));b=b.parent());return"fixed"!==c&&b?b:angular.element(a[0].ownerDocument||document)}var f=!1,g=0;b.e50InfiniteScroll=function(h){var i=g;(!f||h)&&(f=e(c)),f.off("scroll.e50Table"),f.on("scroll.e50Table",function(){var e=d.e50Table?"="+d.e50Table:"",h=c[0].querySelectorAll("[e50-table-row"+e+"]:last-child");angular.forEach(h,function(c){i===g&&c.offsetHeight&&c.offsetTop+c.offsetHeight<f[0].scrollTop+f[0].offsetHeight+200&&(g++,b.e50FetchCount?d.e50InfiniteScroll||b.e50InfiniteScroll():b.$broadcast("e50-infinite-scroll"),d.e50InfiniteScroll&&a(d.e50InfiniteScroll)(b)(function(a){b.e50InfiniteScroll(a)}))})})},b.e50InfiniteScroll()}}}]),angular.module("e50Table").directive("e50NoProp",function(){return{restrict:"A",link:function(a,b){function c(a){a.stopPropagation()}b.on("click",c),b.on("mousedown",c)}}}),angular.module("e50Table").directive("e50Table",["$parse",function(a){return{restrict:"A",scope:!0,controller:["$element","$attrs",function(a,b){this.$element=a,this.$attrs=b}],compile:function(b,c){var d=c.e50Table?"="+c.e50Table:"",e=b[0].querySelectorAll("[e50-table-row"+d+"]");return angular.forEach(e,function(a){var b=document.createAttribute("ng-repeat-start"),d="e50DataKey"in c?c.e50DataKey:"t",e="e50DataProp"in c?"."+c.e50DataProp:"";b.value=d+" in e50FilteredData = (e50GetData()"+e+" | orderBy : e50Sort : e50SortReverse | filter : e50Filter | limitTo : e50LimitTo)",a.attributes.setNamedItem(b);var f=a,g=a;do if(g=g.nextElementSibling,g&&g.hasAttribute("e50-table-row-end")){f=g;break}while(g);f.attributes.setNamedItem(document.createAttribute("ng-repeat-end"))}),function(b,c,d){function e(a){var c=b.e50GetData();return"e50DataProp"in d&&(c=c[d.e50DataProp]),c.indexOf(a)}function f(c,e){e?j=c:a(d.e50Data).assign(b.$parent,c)}function g(a,b,c){if("undefined"==typeof a||"undefined"==typeof b)return f(b,c);var e=a,g=b;if("e50DataProp"in d){e=a[d.e50DataProp]?a[d.e50DataProp]:[],g=b[d.e50DataProp]?b[d.e50DataProp]:[];for(var h in a)h===d.e50DataProp||angular.equals(a[h],b[h])||(a[h]=b[h])}if(!e.length)return f(b,c);for(var i=0,j=!1;!j;i++)i===e.length?(j=!0,Array.prototype.push.apply(e,g.slice(i,g.length))):i===g.length?(j=!0,e.splice(i,e.length-i)):angular.equals(e[i],g[i])||(e[i]=g[i])}var h=[],i=!1;if(b.e50Filter=function(c){return c&&"id"in c&&h.indexOf(c.id)>=0?!1:"e50Filter"in d?a(d.e50Filter)(b)(c):!0},b.e50DeleteRow=function(a){h.push(a.id)},b.$watch(function(){return[a(d.e50Sort)(b),a(d.e50SortReverse)(b)]},function(a){i||(b.e50Sort=a[0]?a[0]:e,b.e50SortReverse=a[1]?!0:!1)},!0),b.$watch(function(){return a(d.e50SortLock)(b)},function(c){if(c){i=!0;for(var f=0;f<b.e50FilteredData.length;f++)b.e50FilteredData[f].$$e50SortLockIndex=f;b.e50Sort="$$e50SortLockIndex",b.e50SortReverse=!1}else{i=!1;var g=a(d.e50Sort)(b);b.e50Sort=g?g:e,b.e50SortReverse=a(d.e50SortReverse)(b)?!0:!1}}),b.$watch(function(){return[a(d.e50LimitTo)(b)]},function(a){b.e50LimitTo=a[0]?a[0]:4815162342},!0),"e50Data"in d)b.e50GetData=function(){return a(d.e50Data)(b)},b.e50SetData=function(c){g(a(d.e50Data)(b),c,!1)};else{var j=[];b.e50GetData=function(){return j},b.e50SetData=function(a){g(j,a,!0)}}b.e50MoveData=function(a,c){var e=b.e50GetData();"e50DataProp"in d&&(e=e[d.e50DataProp]?e[d.e50DataProp]:[]),b.e50FilteredData[a].$$e50MoveFrom=!0,b.e50FilteredData[c].$$e50MoveTo=!0;var f,g;angular.forEach(e,function(a,b){a.$$e50MoveFrom&&(f=b,delete a.$$e50MoveFrom),a.$$e50MoveTo&&(g=b,delete a.$$e50MoveTo)}),e.splice(g,0,e.splice(f,1)[0]),b.$digest()}}}}}]),angular.module("e50Table").directive("e50View",["$timeout",function(a){return{restrict:"A",require:"^e50Table",link:function(b,c,d,e){function f(e){e===d.e50View?(c.removeClass("ng-hide"),a(function(){b.e50InfiniteScroll&&b.e50InfiniteScroll(!0)})):c.addClass("ng-hide")}f(e.$attrs.e50Views),e.$attrs.$observe("e50Views",f)}}}]),angular.module("e50Table").factory("E50Poll",["$timeout",function(a){function b(a,b){this.delay=b?b:1e3,this.callback=a,this.canceled=!1,this.wait()}return b.prototype.poll=function(){var a=this;this.callback().finally(function(){a.canceled||a.wait()})},b.prototype.wait=function(){var b=this;this.timeout=a(function(){b.poll()},this.delay)},b.prototype.stop=function(){this.canceled=!0,a.cancel(this.timeout)},b}]);