/*! e50-table 2014-11-12 */
"use strict";angular.module("e50Table",["ngResource"]),angular.module("e50Table").directive("e50Table",["$interval","Poll","$parse","$compile","$resource",function(a,b,c,d,e){return{restrict:"A",scope:{data:"=?e50Data",use:"@e50Use",rowHover:"@e50RowHover",fetch:"@e50Fetch",fetchParams:"=?e50FetchParams",fetchMethod:"@e50FetchMethod",fetchBody:"=?e50FetchBody",poll:"@e50Poll",sort:"@e50Sort",sortOrder:"@e50SortOrder"},link:function(a,f,g){function h(b,c){var d="desc"===a.sortOrder?"desc":"asc";return b[a.sort]<c[a.sort]?"asc"===d?-1:1:b[a.sort]>c[a.sort]?"asc"===d?1:-1:0}function i(){j.empty();var b=angular.copy(a.data);void 0!==a.sort&&b.sort(h),angular.forEach(b,function(b){var c=a.$new(!0);angular.extend(c,b),angular.extend(c,l);var e=d(k.clone())(c);if("undefined"!=typeof g.e50RowHover){var f=a.rowHover.length?a.rowHover:"hover";e.on("mouseenter",function(){e.addClass(f)}).on("mouseleave",function(){e.removeClass(f)})}j.append(e)}),angular.element(f[0].querySelectorAll("[e50-no-prop]")).on("click",function(a){a.stopPropagation()})}var j=f.find("tbody"),k=j.find("tr"),l={};if(void 0!==a.use&&(a.use=a.use.split(a.use.indexOf(";")>0?";":","),angular.forEach(a.use,function(b){l[b]=c(b)(a.$parent)})),a.$watch("data",function(){i()},!0),a.$watchCollection("[sort, sortOrder]",function(){i()}),a.fetch){var m=e(a.fetch,{},{fetch:{method:void 0!==a.fetchMethod?a.fetchMethod:"GET"}}),n=function(){return m.fetch(a.fetchParams,a.fetchBody).$promise.then(function(b){a.data=b.data})};if("undefined"!=typeof g.e50FetchOnce?n():a.$watchCollection("[fetchParams, fetchBody]",n),"undefined"!=typeof g.e50Poll){var o=new b(n,a.poll);a.$on("$destroy",function(){o.stop()})}}}}}]),angular.module("e50Table").factory("Poll",["$timeout",function(a){function b(a,b){this.delay=void 0!==b?b:1e3,this.callback=a,this.timeout,this.poll()}return b.prototype.poll=function(){console.log("updating");var b=this;this.callback.call().finally(function(){b.timeout=a(function(){b.poll()},b.delay)})},b.prototype.stop=function(){a.cancel(this.timeout)},b}]);