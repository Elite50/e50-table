/*! e50-table 2014-11-12 */
"use strict";angular.module("e50Table",["ngResource"]),angular.module("e50Table").directive("e50Fetch",["$resource","Poll",function(a,b){return{restrict:"A",require:"e50Table",link:function(c,d,e,f){function g(){return h.fetch(f.$scope.fetchParams,f.$scope.fetchBody).$promise.then(function(a){f.$scope.data=a.data})}var h=a(e.e50Fetch,{},{fetch:{method:"e50FetchMethod"in e?e.e50FetchMethod:"GET"}});if("e50FetchOnce"in e?g():f.$scope.$watch("[fetchParams, fetchBody]",g,!0),"e50Poll"in e){var i=new b(g,e.e50Poll);f.$scope.$on("$destroy",function(){i.stop()})}}}}]),angular.module("e50Table").directive("e50NoProp",function(){return{restrict:"A",link:function(a,b){b.on("click",function(a){a.stopPropagation()})}}}),angular.module("e50Table").directive("e50TableRow",function(){return{restrict:"A",require:"^e50Table",link:function(a,b,c){if("e50Hover"in c){var d=c.e50Hover?c.e50Hover:"hover";b.on("mouseenter",function(){b.addClass(d)}).on("mouseleave",function(){b.removeClass(d)})}}}}),angular.module("e50Table").directive("e50Table",["$parse","$compile",function(a,b){return{restrict:"A",scope:{data:"=?e50Data",fetchParams:"=?e50FetchParams",fetchBody:"=?e50FetchBody",sort:"@e50Sort",sortOrder:"@e50SortOrder"},controller:["$scope",function(a){this.$scope=a}],link:function(c,d,e){function f(){i.empty();var a=angular.copy(c.data);"e50Sort"in e&&a.sort(g),angular.forEach(a,function(a){var d=c.$new(!0);angular.extend(d,a),angular.extend(d,j);var e=h.clone();i.append(e),b(e)(d)})}function g(a,b){var d="desc"===c.sortOrder?"desc":"asc";return a[c.sort]<b[c.sort]?"asc"===d?-1:1:a[c.sort]>b[c.sort]?"asc"===d?1:-1:0}var h=d[0].querySelector("[e50-table-row]");h=angular.element(h);var i=h.parent(),j={};if("e50Use"in e){var k=e.e50Use.split(e.e50Use.indexOf(";")>0?";":",");angular.forEach(k,function(b){j[b]=a(b)(c.$parent)})}c.$watch("[data, sort, sortOrder]",function(){f()},!0)}}}]),angular.module("e50Table").factory("Poll",["$timeout",function(a){function b(a,b){this.delay=b?b:1e3,this.callback=a,this.poll()}return b.prototype.poll=function(){var b=this;this.callback().finally(function(){b.timeout=a(function(){b.poll()},b.delay)})},b.prototype.stop=function(){a.cancel(this.timeout)},b}]);