/*! e50-table 2014-11-10 */
"use strict";angular.module("e50Table",["ngResource"]),angular.module("e50Table").directive("e50Table",["Poll","$parse","$compile","$resource",function(a,b,c,d){return{restrict:"A",scope:{data:"=?e50Data",use:"@e50Use",rowHover:"@e50RowHover",fetch:"@e50Fetch",fetchParams:"=?e50FetchParams",fetchMethod:"@e50FetchMethod",fetchBody:"=?e50FetchBody",poll:"@e50Poll",sort:"@e50Sort",sortOrder:"@e50SortOrder"},link:function(e,f,g){function h(a,b){var c="desc"===e.sortOrder?"desc":"asc";return a[e.sort]<b[e.sort]?"asc"===c?-1:1:a[e.sort]>b[e.sort]?"asc"===c?1:-1:0}function i(){j.empty();var a=angular.copy(e.data);void 0!==e.sort&&a.sort(h),angular.forEach(a,function(a){var b=e.$new(!0);angular.extend(b,a),angular.extend(b,l);var d=c(k.clone())(b);if("undefined"!=typeof g.rowHover){var f=e.rowHover.length?e.rowHover:"hover";d.on("mouseenter",function(){d.addClass(f)}).on("mouseleave",function(){d.removeClass(f)})}j.append(d)}),angular.element(f[0].querySelectorAll("[no-prop]")).on("click",function(a){a.stopPropagation()})}var j=f.find("tbody"),k=j.find("tr"),l={};if(void 0!==e.use&&(e.use=e.use.split(e.use.indexOf(";")>0?";":","),angular.forEach(e.use,function(a){l[a]=b(a)(e.$parent)})),e.$watchCollection("[data, sort, sortOrder]",function(){i()}),e.fetch){var m=d(e.fetch,{},{fetch:{method:void 0!==e.fetchMethod?e.fetchMethod:"GET"}}),n=function(){return m.fetch(e.fetchParams,e.fetchBody).$promise.then(function(a){e.data=a.data})};if("undefined"!=typeof g.fetchOnce?n():e.$watchCollection("[fetchParams, fetchBody]",n),"undefined"!=typeof g.poll){var o=new a(n,e.poll);e.$on("$destroy",function(){o.stop()})}}}}}]),angular.module("e50Table").factory("Poll",["$timeout",function(a){function b(a,b){this.delay=void 0!==b?b:1e3,this.callback=a,this.timeout,this.poll()}return b.prototype.poll=function(){console.log("updating");var b=this;this.callback.call().finally(function(){b.timeout=a(function(){b.poll()},b.delay)})},b.prototype.stop=function(){a.cancel(this.timeout)},b}]);